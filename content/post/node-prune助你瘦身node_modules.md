---
title: "node-prune助你瘦身node_modules"
date: 2017-11-28T08:08:08+08:00
draft: false
url: "node-prune"
tags:
  - Node.js
  - NPM
  - Linux
  - Go
categories:
  - Web Technologies
---

最近逛 Github 的 Trending，发现一个 Node.js 项目的辅助工具，作者是鼎鼎大名的[TJ](https://github.com/tj)，用于帮助清理 Node.js 项目中日渐臃肿的`node_modules`，下图是**[node-prune](https://github.com/tj/node-prune)**项目中的一张打趣图，虽然个人觉得这也不是 npm 一家独有的现象，不过还是很形象。

![node-prune-why](https://cdn.itony.net/blog/20171129/34DPA6fy1OfzVdAk0NVC0HTs.jpeg)

那么，先来看一段**[node-prune](https://github.com/tj/node-prune)**的简易描述：

> node-prune is a small tool to prune unnecessary files from ./node_modules, such as markdown, typescript source files, and so on.

接着，简单介绍一下如何安装及使用。

首先，node-prune 这个工具是基于 go 的，所以你的系统上得安装 go，如果你也是使用 MAC 的话，那就比较简单了，直接使用`brew`安装就好了：

```bash
$ brew install go
```

接着就是在本地安装 node-prune：

```bash
$ go get github.com/tj/node-prune/cmd/node-prune
```

这里有点需要注意一下，安装完以后，你会发现无法直接运行`node-prune`这个命令，因为`node-prune`目前的位置是在`~/go/bin`里面，而这个路径可能并不存在于你的`PATH`中，所以你需要手动输入`node-prune`的路径才行。

最后就是使用`node-prune`来清理`node_modules`中的冗余文件了。

```bash
$ ~/go/bin/node-prune /PATH/TO/PROJECT/node_modules
```

`/PATH/TO/PROJECT/node_modules`就是你项目中的`node_modules`路径。

来个效果图
![node-prune-result](https://cdn.itony.net/blog/20171129/rgesyOauhouySm-ZrIF4V7Jz.png)

一个小项目就可以轻松瘦身`25MB`，使用又是如此简单，对于 SSD 硬盘才 250G 的我而言，这个工具确实绝对值得拥有。

最后如果你需要遍历清理一个目录下所有项目的`node_modules`，可以参考一下这个`shell`脚本：

```shell
#!/usr/bin/env bash

find * -prune -type d | while read d; do
  if [[ -e "${d}/package.json" && -d "${d}/node_modules" ]]
  then
    echo "-------- Node.js Repository: { $d } ---------"
    echo "start node-prune process..."
    /PATH/TO/go/bin/node-prune "${d}/node_modules"
    echo "prune done!"
    echo ""
  fi
done
```
