<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Charles小书 - Life & Code</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="tony"><meta name=description content="前言 日常开发中，经常会有与 App 联调的工作，除了 iOS 的 Safari 和 Android 的 adb，用来查看 console 的信息，往往还需要抓取一下 HTTP 的数据包，用来确认网络情况。 概述 Charles 就是"><meta name=keywords content="itony,blog"><meta name=generator content="Hugo 0.108.0 with theme even"><link rel=canonical href=https://itony.net/charles-note/><link rel=apple-touch-icon sizes=180x180 href=/%20apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/%20favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/%20favicon-16x16.png><link rel=manifest href=/%20manifest.json><link rel=mask-icon href=/%20safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet><link rel=stylesheet href=/libs/fancybox/3.5.7/jquery.fancybox.min.css><meta property="og:title" content="Charles小书"><meta property="og:description" content="前言 日常开发中，经常会有与 App 联调的工作，除了 iOS 的 Safari 和 Android 的 adb，用来查看 console 的信息，往往还需要抓取一下 HTTP 的数据包，用来确认网络情况。 概述 Charles 就是"><meta property="og:type" content="article"><meta property="og:url" content="https://itony.net/charles-note/"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-12-21T08:08:08+08:00"><meta property="article:modified_time" content="2017-12-21T08:08:08+08:00"><meta itemprop=name content="Charles小书"><meta itemprop=description content="前言 日常开发中，经常会有与 App 联调的工作，除了 iOS 的 Safari 和 Android 的 adb，用来查看 console 的信息，往往还需要抓取一下 HTTP 的数据包，用来确认网络情况。 概述 Charles 就是"><meta itemprop=datePublished content="2017-12-21T08:08:08+08:00"><meta itemprop=dateModified content="2017-12-21T08:08:08+08:00"><meta itemprop=wordCount content="1765"><meta itemprop=keywords content="Note,Debug Tool,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Charles小书"><meta name=twitter:description content="前言 日常开发中，经常会有与 App 联调的工作，除了 iOS 的 Safari 和 Android 的 adb，用来查看 console 的信息，往往还需要抓取一下 HTTP 的数据包，用来确认网络情况。 概述 Charles 就是"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>I'm A Coder</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>I'm A Coder</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Charles小书</h1><div class=post-meta><span class=post-time>2017-12-21</span><div class=post-category><a href=/categories/web-technologies/>Web Technologies</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#前言>前言</a></li><li><a href=#概述>概述</a></li><li><a href=#功能特点>功能特点</a></li><li><a href=#基本介绍>基本介绍</a></li><li><a href=#如何使用>如何使用</a><ul><li><a href=#设置并开启-charles-代理>设置并开启 Charles 代理</a></li><li><a href=#配置移动设备代理>配置移动设备代理</a></li><li><a href=#配置-ssl-证书抓取-https>配置 SSL 证书，抓取 HTTPS</a></li><li><a href=#20180423>2018.04.23</a></li></ul></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=前言>前言</h2><p>日常开发中，经常会有与 App 联调的工作，除了 iOS 的 Safari 和 Android 的 adb，用来查看 console 的信息，往往还需要抓取一下 HTTP 的数据包，用来确认网络情况。</p><h2 id=概述>概述</h2><p><img src=https://cdn.itony.net/blog/20171221/ZbhlqbjYZdSpsN1aMZFqCZKb.png alt=Charles-thumb></p><p>Charles 就是一款非常优秀的跨平台网络代理工具，支持 Windows、Mac、Linux，不过最重要的是它的功能非常强大，当然这么好的工具当然不是免费的，官方需要 <strong><em>$30 / license</em></strong>， 不过通过一些合作的代理商可能会便宜一些。</p><h2 id=功能特点>功能特点</h2><ul><li>支持<a href=https://www.charlesproxy.com/documentation/proxying/ssl-proxying/>SSL 代理</a> - 以纯文本格式查看 SSL 请求和响应；</li><li>支持<a href=https://www.charlesproxy.com/documentation/proxying/throttling/>限制带宽</a> - 模拟低速的移动网络或者网络延迟的使用场景；</li><li>支持 AJAX 调试 - 以树或文本的形式查看 XML 和 JSON 请求和响应；</li><li>支持<a href=https://www.charlesproxy.com/documentation/additional/amf/>AMF</a>调试 - 以 Flash 的形式查看 Flash Remoting / Flex Remoting 消息的内容；</li><li>支持重复请求以便于后端开发；</li><li>支持编辑 Request 参数；</li><li>支持拦截和编辑 Request 和 Response 的内容；</li><li>支持检查 HTML，CSS 和 RSS 内容是否符合 W3C 标准。</li></ul><h2 id=基本介绍>基本介绍</h2><p>如何安装本文就不累述了，<a href=https://www.charlesproxy.com/documentation/installation/>官网介绍</a>的很详细了，也很简单，对照着自己的环境，下载安装包安装即可。</p><p>Charles 的界面很简洁，分为 Structure 和 Sequence 模式，这 2 种模式可以获取的信息是差不多的，不过 Sequence 模式下多了一个便捷的 Filter 输入框，可以快速的过滤出来当前需要的查看的网络请求。</p><p><img src=https://cdn.itony.net/blog/20171221/nB8wxf7Ubi3q_E6T1x3s6WsA.png alt=screenshot-sequence></p><h2 id=如何使用>如何使用</h2><p>Charles 启动时默认会抓取本机的网络请求，所以一开始，你可能会看到很多网络请求的信息，如果你想停止或者清理，可以用工具条上的便捷键来操作：
<img src=https://cdn.itony.net/blog/20171221/fJNxyicceQHgSlCO_CBwRVbn.png alt=screenshot-tools></p><p>下面就说说在 Mac 下如何通过 Charles 抓取移动设备上的网络请求。</p><p>主要步骤分为以下几步：</p><ol><li>设置并开启 Charles 代理；</li><li>配置移动设备代理；</li><li>如果需要抓取 HTTPS，则需要配置 SSL 证书；</li></ol><h3 id=设置并开启-charles-代理>设置并开启 Charles 代理</h3><p>打开菜单，点击 <strong>Proxy</strong> 一栏，就可以看到 <strong>Proxy Settings&mldr;</strong> 的选项：
<img src=https://cdn.itony.net/blog/20171221/tY6G-QgBla5XYONNANdYjDS1.png alt=screenshot-setting-proxy></p><p>接着在 **Port: ** 一栏中填入代理的端口号，这里填写的是 <strong>8888</strong>：
<img src=https://cdn.itony.net/blog/20171221/9wRBt3GkywN5T22fW431YA4c.png alt=screenshot-proxy-settings></p><p>点击 <strong>OK</strong> 即可生效设置，然后再打开菜单，点击 <strong>Help</strong> 一栏，找到到 <strong>Local IP Address</strong> 获取本机当前局域网中的 IP 地址：
<img src=https://cdn.itony.net/blog/20171221/amM6wJPjStXlXS4KhO4zrwc0.png alt=screenshot-local-ip></p><p><img src=https://cdn.itony.net/blog/20171221/fFgcLY_HiQlHeqLsmKpS-d5c.png alt=screenshot-local-ip-address></p><h3 id=配置移动设备代理>配置移动设备代理</h3><p>以 iOS 为例，操作步骤 <strong>设置</strong> -> <strong>无线局域网</strong> -> <strong>wifi 设置(叹号图标)</strong> -> <strong>HTTP 代理</strong> -> **配置代理 -> <strong>手动</strong> -> <strong>服务器(上一步获取的本机局域网 IP)</strong> 和 **端口(上一步设置的端口号)**：
<img src=https://cdn.itony.net/blog/20171221/xnMrosw2gDOpnnOc5Okg2CKP.png alt=screenshot-ios-wifi-proxy></p><p>如果一切顺利，你的本机 Charles 会有一个提示出现：</p><p><img src=https://cdn.itony.net/blog/20171221/XupFxGQqiaF40rcY-JHyaOxh.png alt=screenshot-charles-allow-tip></p><p>选择 <strong>Allow</strong> 就可以代理你的 iOS 了：
<img src=https://cdn.itony.net/blog/20171221/YvKS5Zdp1JGXAsAsATh-W0I1.png alt=screenshot-charles-ios></p><p>如果你仅仅是需要 HTTP 的代理，那么上述的应该就可以满足了，不过随着 HTTPS 的推广，就需要额外的设置 SSL 证书来获取 HTTPS 的内容了。</p><h3 id=配置-ssl-证书抓取-https>配置 SSL 证书，抓取 HTTPS</h3><p>如果我们在自己的服务上已经配置了 SSL，开启了 HTTPS，那么用 HTTP 的方式抓包就只能看到一堆的乱码了。</p><p>这时候，不过我们可以用 Charles 作为中间人来进行 HTTPS 的代理，用它的根证书动态签发一张证书，同时让你的浏览器收不到服务端证书的，然后 Charles 来伪装服务端的证书，你的浏览器接受 Charles 的证书用于 SSL 加密，而 Charles 仍然用目标服务器的 SSL 证书与服务端进行通信，所以 Charles 就可以用它自己的根证书来解码你发出的请求了，如果想了解的更多，可以去找找有关于中间人攻击的资料。</p><p>具体到操作其实就 3 步：</p><ol><li>在本机安装 Charles 根证书；</li><li>在客户端安装 Charles 提供的证书；</li><li>开启 Charles 的 SSL Proxying；</li></ol><h4 id=在本机安装-charles-根证书>在本机安装 Charles 根证书</h4><p>Charles 提供了非常简单的方式来安装，你只需要打开菜单，点击 <strong>Help</strong> 一栏，选中 <strong>SSL Proxying</strong> 就可以看到 <strong>Install Charles Root Certificate</strong> 的选项：
<img src=https://cdn.itony.net/blog/20171221/HkWIPLTkLD5XjE3nz0fW0pRM.png alt=screenshot-install-charles-root-certificate></p><p>点击安装以后，会打开本地的 <strong>Keychain Access</strong> 提示是否添加，选择 <strong>Add</strong> 即可。
<img src=https://cdn.itony.net/blog/20171221/EDiliS8QmOtE_MprKZvElMIv.png alt=screenshot-add-charles-root-certificate></p><p>由于 Charles 的提供的 SSL 根证书是它自己颁发的，并未经过权威机构的认证，所以，有时候会经常提示证书的安全性问题，这个时候，你可以在 <strong>Keychain Access</strong> 中找到这个证书，并在 <strong>Trust</strong> 一项中选择 <strong>Always Trust</strong>即可：
<img src=https://cdn.itony.net/blog/20171221/_kRgPcKxD8TcWPoyaU6XEERI.png alt=screenshot-keychain-access-trust></p><h4 id=在客户端安装-charles-提供的证书>在客户端安装 Charles 提供的证书</h4><p>打开菜单，点击 <strong>Help</strong> 一栏，选中 <strong>SSL Proxying</strong> 就可以看到 <strong>Install Charles Root Certificate on a Mobile Device or Remote Browser</strong> 的选项，它会提示你用需要连接的设备去访问 <code>chls.pro/ssl</code> 这个 URL：
<img src=https://cdn.itony.net/blog/20171221/aI_gnmQc3morBWWdA1XJSgUk.png alt=screenshot-install-charles-root-certificate-client></p><p>客户端在访问 <code>chls.pro/ssl</code>，会得到一个证书文件，不论是 iOS 还是 Android，都会进入证书的添加环节，下面以 iOS 为例：
<img src=https://cdn.itony.net/blog/20171221/XT7kuUvCrW3zF2twNPzF98dS.png alt=screenshot-client-ssl-installing></p><p>这里需要注意一点，iOS 10.3 以后的系统，需要在 <strong>证书信任设置</strong> 中启用才行（<a href=https://www.charlesproxy.com/documentation/using-charles/ssl-certificates>Charles-ssl-certificates</a>），操作步骤 <strong>设置</strong> -> <strong>通用</strong> -> <strong>关于本机</strong> -> <strong>证书信任设置</strong> -> <strong>开启对应证书</strong>：
<img src=https://cdn.itony.net/blog/20171221/-reJd37URcALSCWHNsIaqL7g.png alt=screenshot-client-ssl-trusted></p><h4 id=开启-charles-的-ssl-proxying>开启 Charles 的 SSL Proxying</h4><p>打开 Charles 的菜单，点击 <strong>Proxy</strong> 一栏，就可以看到 <strong>SSL Proxy Settings&mldr;</strong> 的选项，然后增加一项规则即可：
<img src=https://cdn.itony.net/blog/20171221/1LeqY-6F6Rp-mbpHg_ZN0F4A.png alt=screenshot-charles-ssl-proxy-settings></p><p>好了，本文就先介绍到这，最多也就是操作 6 步，你就可以通过 Charles 截取 HTTPS 的数据包了，当然 Charles 的功能远不止如此，更多的惊喜，你可以慢慢的去挖掘。</p><hr><h3 id=20180423>2018.04.23</h3><p>Q: Android 提示 <strong>键入凭据存储的密码</strong> ？</p><p>A: 检查是否设置了锁屏密码，如果没有需要先设置锁屏密码，再次安装<code>chls.pro/ssl</code>下载的证书，输入锁屏密码即可；</p><hr><h2 id=参考>参考</h2><ul><li><a href=https://www.charlesproxy.com/documentation/>charlesproxy</a></li><li><a href=https://malcolmyu.github.io/2017/02/26/Dive-into-Charles-HTTPS-Proxying/>细说 Charles 配置 HTTPS 代理的乱码问题</a></li><li><a href=http://www.jianshu.com/p/a5265f35980a>Charles 抓包配置流程(Charles4.1.2 iOS)</a></li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>tony</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2017-12-21</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/note/>Note</a>
<a href=/tags/debug-tool/>Debug Tool</a></div><nav class=post-nav><a class=prev href=/macos-php/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">macOS系统PHP7增加Xdebug</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/npm-repository-registry/><span class="next-text nav-default">搭建私有npm仓库</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:zhujf620@email.com class="iconfont icon-email" title=email></a>
<a href=https://github.com/tonyc726 class="iconfont icon-github" title=github></a>
<a href=https://itony.net/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017-
2023<span class=heart><i class="iconfont icon-heart"></i></span><span>本站采用&nbsp;<a href=https://creativecommons.org/licenses/by-nc-nd/4.0/ style=color:#8a8a8a>CC BY-NC-ND 4.0</a>&nbsp;许可协议</span></span><div style=padding-top:5px;padding-bottom:10px><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010802008412" style=display:inline-block;text-decoration:none;height:20px;line-height:20px;color:#8a8a8a><img src=/gongan.png width=20 height=20 alt=浙公网安Logo style=margin-right:3px>浙公网安备33010802008412号</a>
<span style="margin:0 .5em">|</span>
<span><a href=http://www.beian.miit.gov.cn style=color:#8a8a8a>浙ICP备17024120号-1</a></span></div></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=/libs/jquery/3.6.4/jquery.min.js></script>
<script src=/libs/slideout/1.0.1/slideout.min.js></script>
<script src=/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-83193985-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>